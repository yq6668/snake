<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>

<HEAD>
    <TITLE> New Document </TITLE>
    <META NAME="Generator" CONTENT="EditPlus">
    <META NAME="Author" CONTENT="">
    <META NAME="Keywords" CONTENT="">
    <META NAME="Description" CONTENT="">
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            border: 0;
            overflow: hidden;
        }
    </style>
</HEAD>

<BODY>
    <canvas></canvas>
    <script>
        document.addEventListener("DOMContentLoaded", go);

        function go() {
            "use strict";

            let canvas = document.querySelector('canvas');
            let ctx = canvas.getContext('2d');

            canvas.style = 'width: 100%; height: 100%; object-fit:contain; background:#000;';

            let frame = 0;

            function onFrame() {
                canvas.width = 512;
                canvas.height = 256;
                godraysCanvas.width = 128;
                godraysCanvas.height = 64;

                let sunY = Math.cos(frame++ / 512) * 24;


                let godraysCtx = godraysCanvas.getContext('2d');

                let emissionGradient = godraysCtx.createRadialGradient(
                    godraysCanvas.width / 2, godraysCanvas.height / 2 + sunY,
                    0,
                    godraysCanvas.width / 2, godraysCanvas.height / 2 + sunY,
                    44
                );
                godraysCtx.fillStyle = emissionGradient;

                emissionGradient.addColorStop(.1, '#0C0804');
                emissionGradient.addColorStop(.2, '#060201');
                godraysCtx.fillRect(0, 0, godraysCanvas.width, godraysCanvas.height);

                godraysCtx.fillStyle = '#000';

                let skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                skyGradient.addColorStop(0, '#2a3e55');
                skyGradient.addColorStop(.7, '#8d4835');
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                function mountainHeight(position, roughness) {
                    let frequencies = [1721, 947, 547, 233, 73, 31, 7];
                    return frequencies.reduce((height, freq) => height * roughness - Math.cos(freq * position), 0);
                }
                for (let i = 0; i < 4; i++) {
                    ctx.fillStyle = `hsl(7, 23%, ${23 - i * 6}%)`;
                    for (let x = canvas.width; x--;) {
                        let mountainPosition = (frame + frame * i * i) / 1000 + x / 2000;
                        let mountainRoughness = i / 19 - .5;
                        let y = 128 + i * 25 + mountainHeight(mountainPosition, mountainRoughness) * 45;
                        ctx.fillRect(x, y, 1, 999);
                        godraysCtx.fillRect(x / 4, y / 4 + 1, 1, 999);
                    }
                }

                ctx.globalCompositeOperation = godraysCtx.globalCompositeOperation = 'lighter';
                for (let scaleFactor = 1.07; scaleFactor < 5; scaleFactor *= scaleFactor) {
                    godraysCtx.drawImage(
                        godraysCanvas,
                        (godraysCanvas.width - godraysCanvas.width * scaleFactor) / 2,
                        (godraysCanvas.height - godraysCanvas.height * scaleFactor) / 2 - sunY * scaleFactor + sunY,
                        godraysCanvas.width * scaleFactor,
                        godraysCanvas.height * scaleFactor
                    );
                }
                ctx.drawImage(godraysCanvas, 0, 0, canvas.width, canvas.height);
                requestAnimationFrame(onFrame);
            }
            let godraysCanvas = canvas.cloneNode();
            onFrame();
            let encodedMelody = "!!----,*,(444420/20/-0/---,,--//((4444202/;;;;986986420/00--//,,";
            let voiceBuffer = [];
            let ksDelayBuffer = [];
            let sampleOffset = 0;
            let J = 0;
        }
    </script>
</BODY>

</HTML>